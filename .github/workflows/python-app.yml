#!/usr/bin/env python3


def make_terminal_block(expert: CyberSecurityExpert) -> str:
"""Return a fenced code block that looks like an interactive Python REPL and some details."""
now = datetime.utcnow().strftime("%Y-%m-%d %H:%M UTC")
lines = []
lines.append('```python')
lines.append('>>> from soc import CyberSecurityExpert')
lines.append('>>> me = CyberSecurityExpert()')
lines.append('')
lines.append(f">>> me.name\n\"{expert.name}\"")
lines.append('')
lines.append(f">>> me.current_mission()\n\"{expert.current_mission()}\"")
lines.append('')
# Add a compact serialized view
lines.append('# Profile (generated)')
profile = {
'name': expert.name,
'role': expert.role,
'location': expert.location,
'skills': expert.skills,
'generated_at': now,
}
# pretty JSON but inlined as comments
json_blob = json.dumps(profile, indent=2, ensure_ascii=False)
for ln in json_blob.splitlines():
lines.append('# ' + ln)


lines.append('```')
return '\n'.join(lines)




def generate_section() -> str:
expert = CyberSecurityExpert()
banner = '<div align="center">\n\n### ğŸ‘¨â€ğŸ’» **AUTO-GENERATED THREAT PROFILE** ğŸ‘¨â€ğŸ’»\n\n</div>\n'
terminal = make_terminal_block(expert)
extra = '\n*This section is auto-generated by a GitHub Actions workflow.*\n'
return banner + '\n' + terminal + '\n' + extra




def replace_between_markers(readme_path: str, start_marker: str, end_marker: str, new_content: str):
with open(readme_path, 'r', encoding='utf-8') as f:
original = f.read()


if start_marker not in original or end_marker not in original:
raise RuntimeError(f"Markers not found in {readme_path}. Add {start_marker} and {end_marker} to your README.")


pre = original.split(start_marker)[0]
post = original.split(end_marker)[1]
updated = pre + start_marker + '\n' + new_content + '\n' + end_marker + post


with open(readme_path, 'w', encoding='utf-8') as f:
f.write(updated)


return True




def main():
parser = argparse.ArgumentParser()
parser.add_argument('--readme', default='README.md', help='README file to update')
args = parser.parse_args()


start = '<!-- PROFILE_START -->'
end = '<!-- PROFILE_END -->'


new_section = generate_section()
replace_between_markers(args.readme, start, end, new_section)




if __name__ == '__main__':
